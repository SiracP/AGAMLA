<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Agamla Mesajlar | #{userBean.tag}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
        <link href='resources/css/bootstrap.min.css' rel='stylesheet' type='text/css'/>
        <script src="https://kit.fontawesome.com/41f4fd74e6.js" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/ionicons@5.5.1/dist/ionicons.js"></script>

        <link href="http://fonts.googleapis.com/css?family=Nunito:100italic,100,300italic,300,400italic,400,700italic,700,900italic,900" rel="stylesheet" type="text/css"/>
        <link href='resources/css/agamla-css-main.css' rel='stylesheet' type='text/css'/>
        <link href='resources/css/agamla-messages.css' rel='stylesheet' type='text/css'/>

    </h:head>
    <h:body>
        <h:form>
            <nav class="navbar navbar-expand-lg navbar-mobile fixed-top" style="background: #f5f6f6 !important;">
                <button class="navbar-toggler" style="color:darkgray;font-weight: 600;" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span  class="navbar-toggler-icon" style="color:darkgray;font-weight: 800 !important;font-size:18px !important;">☰</span>
                </button>
                <a class="navbar-brand marka mx-auto" style="color:#3383FF; font-size:1.7rem;letter-spacing:0.3rem;" href="#">AGAMLA</a>

                <div class="collapse navbar-collapse " style="background-color:#f5f6f6 !important;" id="navbarCollapse">
                    <div class="search" style="margin-top:20px !important;">
                        <h:form >

                            <h:inputText pt:required="required" class="search-input" pt:placeholder="Agalarını bul..." value="#{userBean.ara}"></h:inputText> <h:link
                                outcome="#{userBean.aramaYap()}"
                                class="search-icon">
                                <i class="fa fa-search"></i>
                            </h:link>
                            <h:commandButton action="#{userBean.aramaYap()}" style="display:none;">

                            </h:commandButton>
                        </h:form>
                    </div>
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <h:link outcome="home.xhtml?faces-redirect=true" class=" nav-link left-Panel-Link"><i class="fas fa-home"></i>&nbsp;&nbsp;&nbsp;&nbsp;Anasayfa</h:link>

                        </li>
                        <li class="nav-item">
                            <h:link outcome="messages.xhtml?faces-redirect=true" class="nav-link left-Panel-Link left-Panel-Link-Selected"><i class="fas fa-envelope"></i>&nbsp;&nbsp;&nbsp;&nbsp;Mesajlar</h:link>

                        </li>
                        <li class="nav-item">
                            <h:link outcome="notifications.xhtml?faces-redirect=true" class="nav-link left-Panel-Link"><i class="fas fa-bell"></i>&nbsp;&nbsp;&nbsp;&nbsp;Bildirimler</h:link>

                        </li>
                        <li class="nav-item">
                            <h:link outcome="profile.xhtml?faces-redirect=true" class="nav-link left-Panel-Link"><i class="fas fa-user-alt"></i>&nbsp;&nbsp;&nbsp;&nbsp;Profil</h:link>

                        </li>
                        <li class="nav-item">
                            <h:link outcome="saves.xhtml?faces-redirect=true" class="nav-link left-Panel-Link"><i class="fas fa-save"></i>&nbsp;&nbsp;&nbsp;&nbsp;Kaydedilenler</h:link>


                        </li>
                        <li class="nav-item">
                            <h:link outcome="settings.xhtml?faces-redirect=true" class="nav-link left-Panel-Link"><i class="fas fa-cog"></i>&nbsp;&nbsp;&nbsp;&nbsp;Ayarlar</h:link>


                        </li>
                        <li class="nav-item">
                            <h:commandLink action="#{userBean.cikisYap()}" class="nav-link left-Panel-Link"><i class="fas fa-power-off"></i>&nbsp;&nbsp;&nbsp;&nbsp;Çıkış Yap</h:commandLink>


                        </li>

                    </ul>


                </div>
            </nav>
        </h:form>
        <div class="">

            <div class="row-main box row ">
                <div class="left-Panel col-0 col-sm-0 col-md-4 col-lg-3 d-none d-md-block ">
                    <div class="stick-top" style="left:8%;">
                        <div class="marka">
                            AGAMLA
                        </div>
                        <div class="Menu">
                            <h:form>
                                <ul class="left-Panel-Menu">
                                    <li>
                                        <h:commandLink action="home.xhtml?faces-redirect=true" class="left-Panel-Link"><i class="fas fa-home"></i>Anasayfa</h:commandLink>
                                    </li>
                                    <li>
                                        <h:commandLink action="messages.xhtml?faces-redirect=true" class="left-Panel-Link left-Panel-Link-Selected"><i class="fas fa-envelope"></i>Mesajlar</h:commandLink>
                                    </li>
                                    <li>
                                        <h:commandLink action="notifications.xhtml?faces-redirect=true" class="left-Panel-Link"><i class="fas fa-bell"></i>Bildirimler</h:commandLink>
                                    </li>
                                    <li>
                                        <h:commandLink action="profile.xhtml?faces-redirect=true" class="left-Panel-Link"><i class="fas fa-user-alt"></i>Profil</h:commandLink>
                                    </li>
                                    <li>
                                        <h:commandLink action="saves.xhtml?faces-redirect=true" class="left-Panel-Link"><i class="fas fa-save"></i>Kaydedilenler</h:commandLink>
                                    </li>
                                    <li>
                                        <h:commandLink action="settings.xhtml?faces-redirect=true" class="left-Panel-Link"><i class="fas fa-cog"></i>Ayarlar</h:commandLink>
                                    </li>

                                </ul>
                            </h:form>
                        </div>
                    </div>

                    <div class="cd-popup" role="alert">
                        <div class="cd-popup-container">
                            <p>Çıkış yapmak istediğine emin misin?</p>
                            <ul class="cd-buttons">



                                <li><h:form>


                                        <h:commandLink action="#{userBean.cikisYap()}">
                                            Evet
                                        </h:commandLink> </h:form>
                                </li>
                                <li><a class="hayirClose" href="#0">Hayır</a></li>
                            </ul>
                            <a href="#0" class="cd-popup-close img-replace"></a>
                        </div> 
                    </div> 
                    <div class="cikisYap cd-popup-trigger" id="cikismyBtn">
                        <div class="cikisYap-Foto">
                            <img width="40px" height="40px"
                                 src="${userBean.profilePictureUri}"
                                 alt="profilResim" style="border-radius: 20px;"/>
                        </div>
                        <div class="cikisYap-Text">
                            <div class="cikisYap-Profil-Ismi">
                                ${userBean.firstName} #{userBean.lastName}
                            </div>
                            <div class="cikisYap-Profil-Username">
                                @#{userBean.tag}
                            </div>

                        </div>
                        <div class="cikisYap-Cikis">
                            <i class="fa fa-sign-out" aria-hidden="true"></i>
                        </div>

                    </div>

                </div>

                <!-->
                
                
                    BURAYA RESPONSIVE OLDUĞUNDA SOL PANELİN YAZISIZ HALİ GELECEK
                    css ile olursa ok yoksa yeni panel yaz.
                </!-->   
                <div class="main-Panel col-12 col-sm-12 col-md-8 col-lg-9 col-xl-6 m-sm-0 m-0 ml-lg-0 w-100">
                    <div class="header-txt">
                        #{userBean.postUserFirstName(param["uid"])} #{userBean.postUserLastName(param["uid"])} ile Mesajların
                        <hr></hr>
                        #{messageBean.contentHata}
                    </div>

                    <h:panelGroup id="mesajlarim">



                        <div class="chat">


                            <ui:repeat value="#{messageBean.chatEkrani(userBean.userId,param['uid'])}" var="item">


                                <div class="row">
                                    <h:panelGroup rendered="#{item.senderId == param['uid']}">
                                        <div class="col-8" >
                                            <div class="row">
                                                <div class="col-2">
                                                    <img width="40px" height="40px" src="${userBean.postUserPictureUri(param['uid'])}" alt="profilResim" style="border-radius: 20px;"/>
                                                </div>
                                                <div class="col-10 emre" style="padding:0px;">
                                                    <div class="messages-card" style="padding:12px 0 12px 13px;background-color:white;color:dark;margin-bottom:0;">
                                                        <div>
                                                            <h:outputText class="chat-content-text" value="#{item.content}"></h:outputText>
                                                        </div>
                                                    </div>
                                                    <div class="message-tarih" style="text-align: left;margin-top:2px; padding-right: 11px;color:darkgray;">
                                                        #{item.createDate}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-4">

                                        </div>

                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{item.senderId == userBean.userId}">
                                        <div class="col-4">

                                        </div>
                                        <div class="col-8" >
                                            <div class="row">
                                                <div class="col-10"  style="padding:0 8px 0 0;">
                                                    <div class="messages-card" style="padding:12px 0 12px 13px;background-color:#3e6fa7;color:white;margin-bottom:0;">
                                                        <div>
                                                            <h:outputText class="chat-content-text" value="#{item.content}"></h:outputText>
                                                        </div>
                                                    </div>
                                                    <div class="message-tarih" style="text-align: right;margin-top:2px; padding-right: 11px;color:darkgray;">
                                                        #{item.createDate}
                                                    </div>
                                                </div>
                                                <div class="col-2">
                                                    <img width="40px" height="40px"
                                                         src="${userBean.profilePictureUri}"
                                                         alt="profilResim" style="border-radius: 20px;"/>
                                                </div>
                                            </div>

                                        </div>
                                    </h:panelGroup>

                                </div>
                            </ui:repeat>
                        </div>
                    </h:panelGroup>




                    <h:form>
                        <div class="mesaj-gonder container">

                            <div class="row">

                                <div class="col-10">
                                    <p:inputTextarea autoResize="false" rows="2" id="text" cols ="75"  styleClass="message-text" pt:placeholder="Agana bir şeyler yaz" pt:required="required"
                                                     pt:maxlength="280" value="#{messageBean.content}"></p:inputTextarea>



                                </div>
                                <div class="col-2 text-left">


                                    <h:commandLink class="btn btn-primary btn-agala btn-mesajGonder" action="#{messageBean.mesajiGonder(userBean.userId)}">
                                        <i class="far fa-paper-plane"></i>
                                    </h:commandLink>


                                </div>
                                <c:if test="#{not empty messageBean.contentHata}">
                                    <p style="color:red;margin:0;padding:0;">#{messageBean.contentHata}</p>
                                </c:if>


                            </div>

                        </div>
                    </h:form>


                </div>

                <div class="right-Panel col-0 col-sm-0 d-md-none col-lg-0 col-xl-3 d-none d-lg-none d-xl-block">
                    <div class="stick-top" style="right:6%;">
                        <div class="search">
                            <h:form >

                                <h:inputText pt:required="required" class="search-input" pt:placeholder="Agalarını bul..." value="#{userBean.ara}"></h:inputText> <h:commandLink
                                    action="#{userBean.aramaYap()}"
                                    class="search-icon">
                                    <i class="fa fa-search"></i>
                                </h:commandLink>
                                <h:commandButton action="#{userBean.aramaYap()}" style="display:none;">

                                </h:commandButton>
                            </h:form>
                        </div>
                        <div>
                            <h:form>
                                <ul class="right-Panel-menu">

                                    <li> 
                                        <h:commandLink action="agalar?faces-redirect=true" class="right-Panel-out-link">2021 Agalar</h:commandLink>
                                    </li>
                                </ul>

                            </h:form>
                        </div>
                    </div>

                </div>
            </div>

        </div>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
                integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
                integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
                integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
        crossorigin="anonymous"></script>
        <script>
            if (#{userBean.isLogged == false}) {
                window.location.href = "login.xhtml";
            }
            window.scrollTo(0, document.body.scrollHeight);
            jQuery(document).ready(function ($) {
                //open popup
                $('.cd-popup-trigger').on('click', function (event) {
                    event.preventDefault();
                    $('.cd-popup').addClass('is-visible');
                });

                //close popup
                $('.cd-popup').on('click', function (event) {
                    if ($(event.target).is('.cd-popup-close') || $(event.target).is('.cd-popup')) {
                        event.preventDefault();
                        $(this).removeClass('is-visible');
                    }
                    if ($(event.target).is('.hayirClose') || $(event.target).is('.cd-popup')) {
                        event.preventDefault();
                        $(this).removeClass('is-visible');
                    }
                });
                //close popup when clicking the esc keyboard button
                $(document).keyup(function (event) {
                    if (event.which == '27') {
                        $('.cd-popup').removeClass('is-visible');
                    }
                });
            });
        </script>
    </h:body>
</html>

